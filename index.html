<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí¨ –õ–æ–∫–∞–ª—å–Ω–∏–π –ß–∞—Ç</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Arial, sans-serif; }
        body { background: linear-gradient(135deg, #6a11cb, #2575fc); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .container { width: 100%; max-width: 900px; height: 700px; background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .auth-screen, .chat-screen { height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 40px; }
        .chat-screen { display: none; }
        .auth-form { width: 100%; max-width: 300px; }
        .auth-input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; }
        .auth-btn { width: 100%; padding: 12px; background: linear-gradient(135deg, #6a11cb, #2575fc); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .error { color: #ff3b30; text-align: center; margin-top: 10px; min-height: 20px; }
        .header { background: linear-gradient(135deg, #6a11cb, #2575fc); color: white; padding: 15px 20px; width: 100%; display: flex; justify-content: space-between; align-items: center; }
        .main { display: flex; flex: 1; width: 100%; }
        .sidebar { width: 250px; background: #f8f9ff; padding: 20px; border-right: 1px solid #eaeaea; }
        .chat-area { flex: 1; display: flex; flex-direction: column; }
        .messages { flex: 1; padding: 20px; overflow-y: auto; background: #fafbff; }
        .message { max-width: 70%; margin: 8px 0; padding: 10px 15px; border-radius: 15px; word-wrap: break-word; }
        .my-message { background: linear-gradient(135deg, #6a11cb, #2575fc); color: white; margin-left: auto; }
        .other-message { background: white; color: #333; border: 2px solid #f0f0f0; margin-right: auto; }
        .input-area { padding: 15px; border-top: 1px solid #eaeaea; display: flex; gap: 10px; background: white; }
        #messageInput { flex: 1; padding: 12px; border: 2px solid #ddd; border-radius: 20px; font-size: 14px; outline: none; }
        #sendBtn { background: #6a11cb; color: white; border: none; padding: 0 20px; border-radius: 20px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ï–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó -->
        <div class="auth-screen" id="authScreen">
            <h1 style="color: #333; margin-bottom: 20px;">üí¨ –õ–æ–∫–∞–ª—å–Ω–∏–π –ß–∞—Ç</h1>
            <div class="auth-form">
                <input type="text" id="username" class="auth-input" placeholder="–í–∞—à–µ —ñ–º'—è" autocomplete="off">
                <button class="auth-btn" onclick="login()">–£–≤—ñ–π—Ç–∏ –≤ —á–∞—Ç</button>
                <div class="error" id="errorMessage"></div>
                <div style="text-align: center; margin-top: 20px; color: #666; font-size: 14px;">
                    –í–≤–µ–¥—ñ—Ç—å –±—É–¥—å-—è–∫–µ —ñ–º'—è<br>
                    –ß–∞—Ç –ø—Ä–∞—Ü—é—î –≤ —Ü—å–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ
                </div>
            </div>
        </div>
        
        <!-- –ï–∫—Ä–∞–Ω —á–∞—Ç—É -->
        <div class="chat-screen" id="chatScreen">
            <div class="header">
                <h2>üí¨ –ß–∞—Ç: <span id="chatName">–ó–∞–≥–∞–ª—å–Ω–∏–π</span></h2>
                <div>
                    <span id="currentUser">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á</span>
                    <button onclick="logout()" style="background: #ff3b30; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-left: 15px;">–í–∏–π—Ç–∏</button>
                </div>
            </div>
            
            <div class="main">
                <div class="sidebar">
                    <button onclick="createChat()" style="width: 100%; padding: 12px; background: #6a11cb; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; margin-bottom: 20px;">
                        ‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ —á–∞—Ç
                    </button>
                    <div style="font-weight: bold; margin-bottom: 10px;">–ú–æ—ó —á–∞—Ç–∏:</div>
                    <div id="chatsList" style="max-height: 300px; overflow-y: auto;"></div>
                </div>
                
                <div class="chat-area">
                    <div class="messages" id="messages">
                        <div style="text-align: center; color: #666; padding: 50px 20px;">
                            <div style="font-size: 60px; margin-bottom: 20px; opacity: 0.5;">üëã</div>
                            <h3 style="margin-bottom: 10px;">–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –≤ —á–∞—Ç!</h3>
                            <p>–°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π —á–∞—Ç –∞–±–æ –æ–±–µ—Ä—ñ—Ç—å —ñ—Å–Ω—É—é—á–∏–π</p>
                        </div>
                    </div>
                    
                    <div class="input-area">
                        <input type="text" id="messageInput" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." disabled>
                        <button id="sendBtn" onclick="sendMessage()" disabled>–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== –õ–û–ö–ê–õ–¨–ù–ï –°–•–û–í–ò–©–ï ==========
        let currentUser = null;
        let currentChat = 'general';
        let chats = {};
        let messages = {};

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ –∑ LocalStorage
        function loadData() {
            const savedChats = localStorage.getItem('chats');
            const savedMessages = localStorage.getItem('messages');
            
            chats = savedChats ? JSON.parse(savedChats) : {
                'general': { name: '–ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Ç', createdBy: 'system', members: [] }
            };
            
            messages = savedMessages ? JSON.parse(savedMessages) : {
                'general': []
            };
        }

        // –ó–±–µ—Ä–µ–≥—Ç–∏ –¥–∞–Ω—ñ
        function saveData() {
            localStorage.setItem('chats', JSON.stringify(chats));
            localStorage.setItem('messages', JSON.stringify(messages));
        }

        // ========== –§–£–ù–ö–¶–Ü–á ==========
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            setTimeout(() => errorDiv.textContent = '', 3000);
        }

        function login() {
            const username = document.getElementById('username').value.trim();
            
            if (!username) {
                showError('–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ —ñ–º\'—è');
                return;
            }
            
            if (username.length < 2) {
                showError('–Ü–º\'—è –º–∞—î –±—É—Ç–∏ –º—ñ–Ω—ñ–º—É–º 2 —Å–∏–º–≤–æ–ª–∏');
                return;
            }
            
            currentUser = username;
            loadData();
            
            // –î–æ–¥–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–æ –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ —á–∞—Ç—É
            if (!chats.general.members.includes(username)) {
                chats.general.members.push(username);
                saveData();
            }
            
            document.getElementById('currentUser').textContent = currentUser;
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('chatScreen').style.display = 'flex';
            
            loadChats();
            selectChat('general');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
            setInterval(loadMessages, 2000);
        }

        function loadChats() {
            const container = document.getElementById('chatsList');
            container.innerHTML = '';
            
            Object.keys(chats).forEach(chatId => {
                const chat = chats[chatId];
                const chatElement = document.createElement('div');
                chatElement.style.cssText = 'padding: 10px; background: white; border-radius: 8px; margin-bottom: 8px; border: 2px solid #ddd; cursor: pointer;';
                chatElement.onclick = () => selectChat(chatId);
                
                if (chatId === currentChat) {
                    chatElement.style.borderColor = '#6a11cb';
                    chatElement.style.background = '#f0f2ff';
                }
                
                chatElement.innerHTML = `
                    <div style="font-weight: bold;">${chat.name}</div>
                    <div style="font-size: 12px; color: #666;">${chat.members?.length || 0} —É—á–∞—Å–Ω–∏–∫—ñ–≤</div>
                `;
                
                container.appendChild(chatElement);
            });
        }

        function selectChat(chatId) {
            currentChat = chatId;
            document.getElementById('chatName').textContent = chats[chatId].name;
            document.getElementById('messageInput').disabled = false;
            document.getElementById('sendBtn').disabled = false;
            document.getElementById('messageInput').focus();
            loadChats();
            loadMessages();
        }

        function loadMessages() {
            if (!messages[currentChat]) messages[currentChat] = [];
            
            const container = document.getElementById('messages');
            const chatMessages = messages[currentChat] || [];
            
            container.innerHTML = '';
            
            if (chatMessages.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 40px 20px;">–©–µ –Ω–µ–º–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å. –ù–∞–ø–∏—à—ñ—Ç—å –ø–µ—Ä—à–µ! üëã</div>';
                return;
            }
            
            chatMessages.forEach(msg => {
                const isMyMessage = msg.sender === currentUser;
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isMyMessage ? 'my-message' : 'other-message'}`;
                messageDiv.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 5px;">${isMyMessage ? '–í–∏' : msg.sender}</div>
                    <div>${msg.text}</div>
                    <div style="font-size: 11px; margin-top: 5px; text-align: right;">${new Date(msg.timestamp).toLocaleTimeString('uk-UA', {hour: '2-digit', minute: '2-digit'})}</div>
                `;
                container.appendChild(messageDiv);
            });
            
            container.scrollTop = container.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text || !currentUser) return;
            
            if (!messages[currentChat]) messages[currentChat] = [];
            
            messages[currentChat].push({
                sender: currentUser,
                text: text,
                timestamp: Date.now()
            });
            
            saveData();
            input.value = '';
            loadMessages();
        }

        function createChat() {
            const chatName = prompt('–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –Ω–æ–≤–æ–≥–æ —á–∞—Ç—É:');
            if (!chatName) return;
            
            const chatId = 'chat_' + Date.now();
            chats[chatId] = {
                name: chatName,
                createdBy: currentUser,
                members: [currentUser],
                createdAt: Date.now()
            };
            
            messages[chatId] = [];
            saveData();
            loadChats();
            selectChat(chatId);
        }

        function logout() {
            if (confirm('–í–∏–π—Ç–∏ –∑ —á–∞—Ç—É?')) {
                currentUser = null;
                document.getElementById('chatScreen').style.display = 'none';
                document.getElementById('authScreen').style.display = 'flex';
                document.getElementById('username').value = '';
                document.getElementById('username').focus();
            }
        }

        // –û–±—Ä–æ–±–∫–∞ Enter
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ñ–æ–∫—É—Å
        document.getElementById('username').focus();

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É
        loadData();
    </script>
</body>
</html>

